# SegFormer4Card æ‰‹å†™ç¬”è¿¹æ“¦é™¤æ¨¡å‹å®ç°è®¡åˆ’

## é¡¹ç›®æ¦‚è¿°
åŸºäº SegFormer è¯­ä¹‰åˆ†å‰²æ¨¡å‹çš„è¯•å·æ‰‹å†™ç¬”è¿¹è¯†åˆ«ä¸æ“¦é™¤ç³»ç»Ÿï¼Œå®ç° main.ipynb çš„åŠŸèƒ½ã€‚

## å½“å‰è¿›å±•

### âœ… å·²å®Œæˆçš„å·¥ä½œ

1. **æ•°æ®å¤„ç†æ¨¡å—ç»Ÿä¸€åŒ–**
   - åˆ›å»ºäº† `data_processor.py` ç»Ÿä¸€å¤„ç†æ•°æ®è§£å‹å’ŒCSVç”Ÿæˆ
   - ç§»é™¤äº†ç¡¬ç¼–ç è·¯å¾„ï¼Œæ”¯æŒé…ç½®åŒ–å‚æ•°
   - åˆå¹¶äº†åŸæ¥çš„ `extract_dataset.py` å’Œ `generate_csv.py`
   - æ”¯æŒè‡ªåŠ¨æ£€æµ‹æ•°æ®é›†ç›®å½•ç»“æ„

2. **è®­ç»ƒè„šæœ¬ä¼˜åŒ–**
   - æ›´æ–°äº† `train_demo.py` ä½¿ç”¨æ–°çš„æ•°æ®å¤„ç†å™¨
   - ä¿®å¤äº†æ¨¡å‹å¯¼å…¥å’Œå‚æ•°è°ƒç”¨é—®é¢˜
   - æ·»åŠ äº†é…ç½®åŒ–çš„æ•°æ®è·¯å¾„æ”¯æŒ

3. **å®¹å™¨ç¯å¢ƒæµ‹è¯•**
   - åœ¨ `ocr-autoscore` å®¹å™¨ä¸­æˆåŠŸè¿è¡Œæ•°æ®å¤„ç†è„šæœ¬
   - æˆåŠŸè§£å‹è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†
   - ç”Ÿæˆäº†è®­ç»ƒé›†CSV (864ä¸ªæ ·æœ¬) å’ŒéªŒè¯é›†CSV (217ä¸ªæ ·æœ¬)
   - ç”Ÿæˆäº†æµ‹è¯•é›†CSV (200ä¸ªæ ·æœ¬)

### ğŸ”„ å½“å‰é—®é¢˜

1. **ä¾èµ–å…¼å®¹æ€§é—®é¢˜**
   - paddleseg ç‰ˆæœ¬ä¸ PaddlePaddle å­˜åœ¨å…¼å®¹æ€§é—®é¢˜
   - éœ€è¦è§£å†³ `AttributeError: module 'paddleseg' has no attribute 'optimizers'` é”™è¯¯

2. **æ¨¡å‹æ¶æ„é—®é¢˜**
   - work/model.py ä¸­çš„ SegFormer å®ç°ä¾èµ– paddleseg
   - éœ€è¦åˆ›å»ºç‹¬ç«‹çš„ SegFormer å®ç°æˆ–è§£å†³ä¾èµ–é—®é¢˜

3. **è·¯å¾„çµæ´»æ€§é—®é¢˜** (âœ… å·²è§£å†³)
   - `data_processor.py` å’Œ `train_demo.py` å·²æ›´æ–°ï¼Œé€šè¿‡åŠ¨æ€è®¡ç®—é¡¹ç›®æ ¹ç›®å½•æ¥ç®¡ç†æ•°æ®è·¯å¾„ï¼Œç§»é™¤äº†ç¡¬ç¼–ç ã€‚

## æ–‡ä»¶ç»“æ„

```
SegFormer4Card/
â”œâ”€â”€ data_processor.py          # ç»Ÿä¸€æ•°æ®å¤„ç†è„šæœ¬ âœ…
â”œâ”€â”€ train_demo.py              # è®­ç»ƒä¸»è„šæœ¬ âœ…
â”œâ”€â”€ work/
â”‚   â”œâ”€â”€ dataloader.py         # æ•°æ®åŠ è½½å™¨ âœ…
â”‚   â”œâ”€â”€ model.py              # æ¨¡å‹å®šä¹‰ âš ï¸ (ä¾èµ–é—®é¢˜)
â”‚   â”œâ”€â”€ loss.py               # æŸå¤±å‡½æ•° âœ…
â”‚   â””â”€â”€ utils.py              # å·¥å…·å‡½æ•° âœ…
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ data127971/           # åŸå§‹æ•°æ®é›†
â”‚   â””â”€â”€ extracted/            # è§£å‹åæ•°æ® âœ…
â””â”€â”€ implementation_plan.md     # å®ç°è®¡åˆ’æ–‡æ¡£ âœ…
```

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä¿®å¤ä¾èµ–é—®é¢˜
- é™çº§æˆ–å‡çº§ paddleseg åˆ°å…¼å®¹ç‰ˆæœ¬
- ä¿®æ”¹ work/model.py ä¸­çš„å¯¼å…¥æ–¹å¼

### æ–¹æ¡ˆ2: ç‹¬ç«‹å®ç°
- åˆ›å»ºä¸ä¾èµ– paddleseg çš„ SegFormer å®ç°
- ä½¿ç”¨çº¯ PaddlePaddle API å®ç°æ¨¡å‹

### æ–¹æ¡ˆ3: ç®€åŒ–æ¨¡å‹
- ä½¿ç”¨æ›´ç®€å•çš„åˆ†å‰²æ¨¡å‹ä½œä¸ºæ›¿ä»£
- ç¡®ä¿æ ¸å¿ƒåŠŸèƒ½å¯ä»¥æ­£å¸¸è¿è¡Œ

## æµ‹è¯•å‘½ä»¤

### æ•°æ®å¤„ç†æµ‹è¯•
```bash
docker exec -it ocr-autoscore python3 segmentation/SegFormer4Card/data_processor.py \
  --data_root /app/segmentation/SegFormer4Card/data/data127971 \
  --extract_root /app/segmentation/SegFormer4Card/data/extracted
```

### è®­ç»ƒè„šæœ¬æµ‹è¯•
```bash
docker exec -it ocr-autoscore python3 segmentation/SegFormer4Card/train_demo.py \
  --train 1 --arch segformer_b2 --batchSize 2 --loadSize 256 --num_epochs 1 \
  --lr 0.001 --numOfWorkers 0 \
  --data_root /app/segmentation/SegFormer4Card/data/data127971 \
  --extract_root /app/segmentation/SegFormer4Card/data/extracted
```

## ä¸‹ä¸€æ­¥è®¡åˆ’

1. **è§£å†³ä¾èµ–é—®é¢˜**
   - ç ”ç©¶ paddleseg ç‰ˆæœ¬å…¼å®¹æ€§
   - å°è¯•ä¸åŒçš„å®‰è£…æ–¹å¼æˆ–ç‰ˆæœ¬

2. **æ¨¡å‹å®ç°**
   - å¦‚æœä¾èµ–é—®é¢˜æ— æ³•è§£å†³ï¼Œåˆ›å»ºç®€åŒ–çš„åˆ†å‰²æ¨¡å‹
   - ç¡®ä¿è®­ç»ƒæµç¨‹å¯ä»¥æ­£å¸¸è¿è¡Œ

3. **åŠŸèƒ½éªŒè¯**
   - å®Œæˆç«¯åˆ°ç«¯çš„è®­ç»ƒæµ‹è¯•
   - éªŒè¯æ¨¡å‹æ¨ç†åŠŸèƒ½
   - å®ç°å›¾åƒæ©ç ç”Ÿæˆ

4. **é›†æˆåˆ° main.ipynb**
   - å°†è®­ç»ƒå¥½çš„æ¨¡å‹é›†æˆåˆ° Jupyter Notebook
   - æä¾›å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹

## æŠ€æœ¯æ ˆ

- **æ·±åº¦å­¦ä¹ æ¡†æ¶**: PaddlePaddle
- **æ¨¡å‹æ¶æ„**: SegFormer (è¯­ä¹‰åˆ†å‰²)
- **æ•°æ®å¤„ç†**: OpenCV, PIL
- **å®¹å™¨ç¯å¢ƒ**: Docker (ocr-autoscore)
- **ç¼–ç¨‹è¯­è¨€**: Python 3.6+

## å¤‡æ³¨

- æ‰€æœ‰è·¯å¾„å·²é…ç½®åŒ–ï¼Œé¿å…ç¡¬ç¼–ç 
- æ•°æ®å¤„ç†è„šæœ¬æ”¯æŒå‘½ä»¤è¡Œå‚æ•°
- è®­ç»ƒè„šæœ¬æ”¯æŒå¤šç§é…ç½®é€‰é¡¹
- åœ¨å®¹å™¨ç¯å¢ƒä¸­æµ‹è¯•é€šè¿‡æ•°æ®å¤„ç†åŠŸèƒ½